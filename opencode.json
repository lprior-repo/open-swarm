{
  "$schema": "https://opencode.ai/config.json",

  "model": "anthropic/claude-sonnet-4-5",
  "small_model": "anthropic/claude-haiku-4-5",

  "provider": {
    "anthropic": {
      "options": {
        "apiKey": "{env:ANTHROPIC_API_KEY}"
      }
    }
  },

  "tools": {
    "write": true,
    "edit": true,
    "read": true,
    "bash": true,
    "grep": true,
    "glob": true,
    "list": true,
    "webfetch": true,
    "serena_*": true,
    "agent-mail_*": true,
    "beads_*": true,
    "tdd-guard_*": true
  },

  "permission": {
    "write": "allow",
    "edit": "allow",
    "read": "allow",
    "bash": "allow",
    "webfetch": "allow",
    "agent-mail_*": "allow",
    "beads_*": "allow",
    "serena_*": "allow",
    "tdd-guard_*": "allow"
  },

  "formatter": {
    "gofmt": {
      "command": ["gofmt", "-w", "$FILE"],
      "extensions": [".go"]
    },
    "prettier": {
      "command": ["prettier", "--write", "$FILE"],
      "extensions": [".json", ".md", ".yaml", ".yml"]
    }
  },

  "mcp": {
    "agent-mail": {
      "type": "remote",
      "url": "http://localhost:8765/mcp",
      "enabled": true,
      "timeout": 30000
    },
    "serena": {
      "type": "local",
      "command": [
        "sh",
        "-c",
        "PATH=\"$HOME/go/bin:$PATH\" uvx --from git+https://github.com/oraios/serena serena start-mcp-server --context ide --mode editing --project \"$PWD\""
      ],
      "enabled": true,
      "timeout": 60000
    },
    "beads": {
      "type": "local",
      "command": ["beads-mcp"],
      "environment": {
        "BEADS_USE_DAEMON": "1",
        "BEADS_ACTOR": "opencode"
      },
      "enabled": true,
      "timeout": 30000
    }
  },

  "lsp": {
    "typescript": {
      "command": ["typescript-language-server", "--stdio"],
      "filetypes": [".ts", ".tsx", ".js", ".jsx"],
      "rootPatterns": ["package.json", "tsconfig.json"]
    }
  },

  "instructions": [
    "AGENTS.md",
    "CONTRIBUTING.md"
  ],

  "agent": {
    "validator": {
      "description": "Validation engine using Claude Opus 4.5 for rigorous code verification",
      "mode": "subagent",
      "model": "anthropic/claude-opus-4-5",
      "temperature": 0.1,
      "max_steps": 50,
      "tools": {
        "write": false,
        "edit": false,
        "read": true,
        "bash": true,
        "serena_*": true
      },
      "prompt": "You are a validation engine using Claude Opus 4.5 for rigorous verification. Perform deep analysis of code correctness, security vulnerabilities, architectural soundness, test coverage, and requirement compliance. Use advanced reasoning to identify subtle bugs, edge cases, and potential issues."
    },
    "coordinator": {
      "description": "Multi-agent coordination specialist using Agent Mail and Beads",
      "mode": "subagent",
      "model": "anthropic/claude-sonnet-4-5",
      "temperature": 0.3,
      "max_steps": 30,
      "tools": {
        "write": false,
        "edit": false,
        "read": true,
        "agent-mail_*": true,
        "beads_*": true
      },
      "prompt": "You specialize in coordinating multiple agents using Agent Mail for messaging and file reservations, and Beads for task management. Focus on communication, task assignment, and conflict resolution."
    },
    "reviewer": {
      "description": "Code review specialist for Go projects",
      "mode": "subagent",
      "model": "anthropic/claude-sonnet-4-5",
      "temperature": 0.2,
      "max_steps": 40,
      "tools": {
        "write": false,
        "edit": false,
        "read": true,
        "grep": true,
        "glob": true,
        "serena_*": true
      },
      "prompt": "You are a Go code review expert. Focus on: security vulnerabilities, performance issues, idiomatic Go patterns, error handling, test coverage, and Clean Architecture principles."
    },
    "tester": {
      "description": "Test writing specialist for Go",
      "mode": "subagent",
      "model": "anthropic/claude-sonnet-4-5",
      "temperature": 0.3,
      "max_steps": 50,
      "tools": {
        "write": true,
        "edit": true,
        "read": true,
        "bash": true,
        "glob": true,
        "serena_*": true
      },
      "prompt": "You write comprehensive Go tests using table-driven patterns. Focus on unit tests, integration tests, mocking interfaces, and achieving high coverage."
    },
    "explorer": {
      "description": "Fast codebase exploration and search specialist",
      "mode": "subagent",
      "model": "anthropic/claude-haiku-4-5",
      "temperature": 0.2,
      "max_steps": 30,
      "tools": {
        "write": false,
        "edit": false,
        "read": true,
        "grep": true,
        "glob": true,
        "list": true,
        "serena_*": true
      },
      "prompt": "You specialize in fast codebase exploration. Find files by patterns, search code for keywords, and answer questions about the codebase structure. Be quick and thorough."
    },
    "documenter": {
      "description": "Documentation writer for Go projects",
      "mode": "subagent",
      "model": "anthropic/claude-sonnet-4-5",
      "temperature": 0.4,
      "max_steps": 30,
      "tools": {
        "write": true,
        "edit": true,
        "read": true,
        "glob": true,
        "serena_*": true
      },
      "prompt": "You write clear, concise documentation for Go projects. Focus on README files, code comments, API documentation, and architectural docs. Follow Go documentation conventions."
    }
  },

  "command": {
    "validate": {
      "description": "Deep validation using Claude Opus 4.5",
      "template": "Perform rigorous validation of $ARGUMENTS using Claude Opus 4.5. Check: correctness, security vulnerabilities, edge cases, test coverage, architectural soundness, requirement compliance, and subtle bugs.",
      "agent": "validator"
    },
    "sync": {
      "description": "Synchronize with Agent Mail coordination state",
      "template": "Register this agent with Agent Mail and fetch recent coordination messages. Project key: {env:PWD}. Check inbox, file reservations, and active agents."
    },
    "reserve": {
      "description": "Reserve files for exclusive editing via Agent Mail",
      "template": "Reserve files matching pattern: $ARGUMENTS. Use exclusive=true, TTL=3600 seconds. Project: {env:PWD}"
    },
    "release": {
      "description": "Release file reservations",
      "template": "Release all file reservations for this agent in project {env:PWD}"
    },
    "task-ready": {
      "description": "Check for ready work in Beads",
      "template": "Run 'bd ready --json' and analyze the output. Show unblocked tasks ready to work on."
    },
    "task-start": {
      "description": "Start work on a Beads task",
      "template": "Update Beads task $ARGUMENTS to status 'in_progress'. Reserve related files via Agent Mail. Report task details."
    },
    "task-complete": {
      "description": "Complete a Beads task",
      "template": "Close Beads task $ARGUMENTS with reason. Release file reservations. Update thread in Agent Mail if applicable."
    },
    "review": {
      "description": "Comprehensive code review",
      "template": "Review $ARGUMENTS for: security issues, performance problems, Go best practices, error handling, test coverage.",
      "agent": "reviewer"
    },
    "explore": {
      "description": "Fast codebase exploration",
      "template": "Explore the codebase to answer: $ARGUMENTS. Find relevant files, search for patterns, and provide a concise answer.",
      "agent": "explorer"
    },
    "test": {
      "description": "Write tests for specified code",
      "template": "Write comprehensive Go tests for $ARGUMENTS. Use table-driven patterns, test edge cases, and ensure high coverage.",
      "agent": "tester"
    },
    "doc": {
      "description": "Generate documentation",
      "template": "Write documentation for $ARGUMENTS. Follow Go conventions and keep it clear and concise.",
      "agent": "documenter"
    },
    "build": {
      "description": "Build the project",
      "template": "Run 'go build ./...' and report any errors. If successful, confirm the build completed."
    },
    "lint": {
      "description": "Run linters on the codebase",
      "template": "Run 'golangci-lint run' and report any issues found. Suggest fixes for critical issues."
    }
  },

  "keybinds": {
    "leader": "ctrl+x"
  },

  "tui": {
    "scroll_speed": 1.5,
    "scroll_acceleration": {
      "enabled": true,
      "factor": 1.2
    }
  },

  "share": "manual",
  "autoupdate": true,
  "theme": "opencode"
}
